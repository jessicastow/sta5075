---
title: "STA5075: Practical 16"
author: "Jessica Stow (STWJES003@myuct.ac.za)"
date: "2025-02-13"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

Download and import the the “tobacco.txt” 

The response variable burn measures the rate of cigarette burn in inches per 1000 seconds while the explanatory variables are percentages of total nitrogen, chlorine, potassium, phosphorous, calcium and magnesium. It is assumed that the true relationship between the burn rate and the explanatory variables is linear.
• Explore the data, in particular the relationships between the response and each of the explanatory variables. Show some evidence of your exploratory data analysis and display the relationships on a single plot.
• Build a correlation matrix that displays the correlations between the response and each of the explanatory variables.

```{r}
tobacco <- read.delim("tobacco.txt")
View(tobacco)
```

```{r}
summary(tobacco)
```

```{r}
data(mtcars) 
# Create a scatter plot matrix using the pairs() function 
pairs(mtcars[, c(1, 3:6)], main = "Scatter Plot Matrix for mtcars Dataset")

```


```{r}
par(mfrow = c(2,4))

## Relationship between burn and sugar
plot(tobacco$burn, tobacco$sugar)

## Relationship between burn and nicotine
plot(tobacco$burn, tobacco$nicotine)

## Relationship between burn and nitrogen
plot(tobacco$burn, tobacco$nitrogen)

## Relationship between burn and chlorine
plot(tobacco$burn, tobacco$chlorine)

## Relationship between burn and potas
plot(tobacco$burn, tobacco$potas)

## Relationship between burn and phospho
plot(tobacco$burn, tobacco$phospho)

## Relationship between burn and calcium
plot(tobacco$burn, tobacco$calcium)

## Relationship between burn and magnes
plot(tobacco$burn, tobacco$magnes)


```
```{r}
# Correlation matrix
cor(tobacco)
```

Fit a simple linear regression model using lm() and print the model output. Choose the most pertinent explanatory variable to model the response variable, providing a motivation for your choice from the output in (a).

```{r}
#perform ordinary least squares regression using lm() function from stats package:
ols <- lm(tobacco$burn ~ tobacco$chlorine)

plot(x = tobacco$chlorine, y = tobacco$burn)
abline(ols, col="red", lty=2)
```

# optimising for intercept and coefficients
# use chlorine because it has the strongest correlation (neg corr)

```{r}
regression_f <- function(betav,x,y){
  # x = explanatory variable
  # y = response variable
  # betav = c(intercept, slope)
  intercept <- betav[1]
  slope <- betav[2]
  fitted_values <- intercept + slope*x 
  residuals <- y - fitted_values
  SSE <- sum(residuals^2) # a loss function return (SSE)
}

olsfit <- optim(par = c(10,10), 
                fn = regression_f, 
                y = tobacco$burn, 
                x = tobacco$chlorine) 
olsfit$par

# lm 
lm(burn ~ chlorine, data = tobacco)
```

# use optim to optimise the max log likelihood

```{r}
int.par <- c(0.5, 0.5, 0.5)

likelihood_f <- function(int.par, x, y){
  var <- int.par[1]
  intercept <- int.par[2]
  slope <- int.par[3]
  n <- length(y)
  ll <- -0.5*n*log(2*pi)-0.5*n*log(var)-0.5*(1/var)*sum((y-intercept-slope*x)^2)
  return(-ll)
}

optim(par = int.par, 
      fn = likelihood_f, 
      y = tobacco$burn, 
      x = tobacco$chlorine,
      method = "L-BFGS-B",
      lower = c(0.0001, -Inf, -Inf), 
      upper = c(Inf, Inf, Inf)) 
```

